# Mingw-w64 项目介绍
Mingw-w 64是一个头文件、导入库、库和工具的集合，当与编译器工具链（如GCC或LLVM）结合使用时，它为构建本机Windows应用程序和库提供了一个完整的开发环境。

## 1. Mingw-w64 项目介绍
MinGW-W64 是 Windows 平台 上的一个 GNU 工具链（GCC、GDB、Binutils 等），用于编译原生的 32 位（i686）和 64 位（x86_64） Windows 程序。它是 MinGW（Minimalist GNU for Windows） 的增强版，支持更现代的 Windows API 和 C/C++ 标准。

它的核心目标是：
- **提供 Windows 原生 GCC 编译器**（不依赖 Cygwin/MSYS）。
- **支持 64 位（x86_64）和 32 位（i686）架构**。
- **兼容最新的 Windows SDK 和 C/C++ 标准**（如 C11/C++23）。
- **改进异常处理、线程模型和运行时库**。

主要应用优势：
- **MinGW-W64 是 Windows 上最强大的 GCC 移植**，支持现代 C/C++ 标准。
- **版本差异主要源于架构、线程模型和异常处理**，需根据项目需求选择。
- **推荐使用 MSYS2 管理 MinGW-W64**，便于更新和依赖管理。
- **适合替代 MSVC**，尤其需要跨平台或开源兼容的场景。

### 1.2. MinGW-W64 的核心功能
| 功能 | 说明 |
|------|------|
| **GCC 编译器** | 支持 C/C++/Fortran/Ada 等 |
| **GDB 调试器** | 用于调试 Windows 程序 |
| **Binutils** | 包含 `ld`（链接器）、`as`（汇编器）等 |
| **Make/CMake 支持** | 用于自动化构建 |
| **Windows API 支持** | 可直接调用 `Win32`/`DirectX` 等 API |
| **POSIX 兼容层** | 可选支持 `pthreads`（`posix` 线程模型） |
| **UCRT（Universal CRT）** | 新版 Windows 10+ 的 C 运行时库 |

### 1.3. 版本选择
- **(1) 架构（Architecture）**
    - **i686**：32 位 Windows 程序（兼容 XP~11）。
    - **x86_64**：64 位 Windows 程序（现代主流）。

- **(2) 线程模型（Threading）**

    | 线程模型 | 适用场景 | 备注 |
    |----------|----------|------|
    | **win32** | 纯 Windows API 线程 | 兼容性好，但不支持 C++11 `<thread>` |
    | **posix** | 模拟 POSIX 线程（pthreads） | 支持 C++11 多线程，适合跨平台代码 |

- **(3) 异常处理（Exception Handling）**

    | 异常处理 | 适用架构 | 说明 |
    |----------|----------|------|
    | **seh** | x86_64 | 结构化异常处理（Windows 原生，性能好） |
    | **dwarf** | i686 | 较慢，但兼容性更好 |
    | **sjlj** | i686/x86_64 | 较老的方式，不推荐新项目使用 |

-  **(4) C 运行时库（CRT）**

    | CRT 类型 | 说明 |
    |----------|------|
    | **msvcrt** | 旧版 Windows（XP~7）默认 CRT |
    | **ucrt** | Windows 10+ 通用 CRT（推荐） |

-  **(5) 如何选择合适的版本？**

    | 需求 | 推荐选择 |
    |------|----------|
    | **64 位 Windows 开发** | `x86_64-posix-seh-ucrt` |
    | **32 位 Windows 开发** | `i686-posix-dwarf-ucrt` |
    | **兼容旧版 Windows（XP）** | `i686-win32-sjlj-msvcrt` |
    | **C++11 多线程开发** | 必须选 `posix` 线程模型 |
    | **高性能异常处理** | `seh`（仅 x86_64） |

### 1.4. MinGW-W64 vs 其他工具链
| 工具链 | 特点 | 适用场景 |
|--------|------|----------|
| **MinGW-W64** | 原生 Windows GCC，不依赖 POSIX 层，支持 32/64 位 | 开发 Windows 原生应用，兼容性要求高 |
| **MSVC (Microsoft Visual C++)** | 微软官方编译器，深度集成 Windows SDK | Visual Studio 开发，DirectX/WinRT 开发 |
| **Cygwin** | 提供完整的 POSIX 环境，依赖 `cygwin1.dll` | 移植 Unix/Linux 程序到 Windows |
| **MSYS2** | 基于 Cygwin 改进，提供 `pacman` 包管理 | 开发跨平台工具（如 Git、Python） |
| **Clang/LLVM** | 支持 Windows，但运行时库依赖 MSVC 或 MinGW | 需要现代 C++ 特性（如 C++20 Modules） |

### 1.5. MinGW-W64 的常见问题
- **(1) 为什么编译的程序依赖 `libgcc_s_seh-1.dll`？**
    - 如果使用 `seh` 异常处理，运行时需要该 DLL。
    - **解决方案**：静态链接（`-static`）或发布时带上该 DLL。

- **(2) 如何解决 `undefined reference to WinMain`？**
    - 检查是否误用 `-mwindows`（图形界面程序）或 `-mconsole`（控制台程序）。

- **(3) 如何升级 MinGW-W64？**
    - 直接下载新版压缩包，替换旧版（注意备份配置）。
    - 在 MSYS2 中可用 `pacman -S mingw-w64-x86_64-gcc` 更新。

- **(4) 如何支持 C++20/C++23？**
    - 使用最新版 MinGW-W64（GCC 13+），并添加编译选项：
        ```sh
        g++ -std=c++20 -O2 main.cpp -o main.exe
        ```

## 2. MinGW-w64 提供的预构建的（即已编译好的）工具链介绍
[ MinGW-w64 ](https://www.mingw-w64.org/downloads/) 官网提供了多种用于不同系统开发的预构建的工具链项目：

<table>
    <tbody>
        <tr>
            <th>
            </th>
            <th>Version </th>
            <th>Host </th>
            <th>GCC / mingw-w64 Version </th>
            <th>Languages </th>
            <th>Additional Software in Package Manager </th>
        </tr>
        <tr>
            <td style="text-align:center;">
                <strong><a href="https://www.mingw-w64.org/downloads/#arch-linux"><img src="https://www.mingw-w64.org/logos/archlinux-logo.png" title="Arch Linux logo" alt="Arch Linux logo" width="32"></a><br><a href="https://www.mingw-w64.org/downloads/#arch-linux"> Arch
                        Linux</a></strong>
            </td>
            <td>Rolling</td>
            <td>Linux</td>
            <td>
                <a href="https://archlinux.org/packages/extra/x86_64/mingw-w64-gcc/" class="urlextern" title="https://archlinux.org/packages/extra/x86_64/mingw-w64-gcc/" rel="nofollow">14.2.0</a>/<a href="https://archlinux.org/packages/extra/any/mingw-w64-crt/" class="urlextern" title="https://archlinux.org/packages/extra/any/mingw-w64-crt/" rel="nofollow">12.0.0</a>
            </td>
            <td>Ada, C, C++, Fortran, Obj-C, Obj-C++ </td>
            <td><a href="https://aur.archlinux.org/packages/?K=mingw-w64">many</a></td>
        </tr>
        <tr>
            <td style="text-align:center;">
                <strong><a href="https://www.mingw-w64.org/downloads/#cygwin"><img src="https://www.mingw-w64.org/logos/cygwin-logo.png" title="Cygwin logo" alt="Cygwin logo" width="32"></a><br>
                            <a href="https://www.mingw-w64.org/downloads/#cygwin">Cygwin</a></strong>
            </td>
            <td>Rolling</td>
            <td>Windows</td>
            <td>
                <a href="https://cygwin.com/packages/summary/mingw64-x86_64-gcc-src.html" class="urlextern" title="https://cygwin.com/packages/summary/mingw64-x86_64-gcc-src.html" rel="nofollow">12.4.0</a>/<a href="https://cygwin.com/packages/summary/mingw64-x86_64-runtime-src.html" class="urlextern" title="https://cygwin.com/packages/summary/mingw64-x86_64-runtime-src.html" rel="nofollow">12.0.0</a>
            </td>
            <td>C, C++, Fortran, Obj-C </td>
            <td><a href="https://cygwin.com/cgi-bin2/package-grep.cgi?grep=mingw64-x86_64&amp;arch=x86_64"> many</a> </td>
        </tr>
        <tr>
            <td style="text-align:center;" rowspan="3">
                <strong><a href="https://www.mingw-w64.org/downloads/#debian"><img src="https://www.mingw-w64.org/logos/debian-logo.png" title="Debian logo" alt="Debian logo" width="32"></a>
                <br>
                <a href="https://www.mingw-w64.org/downloads/#debian">Debian</a></strong>
            </td>
            <td colspan="2">Debian 10 (Buster) </td>
            <td>8.3.0/6.0.0 </td>
            <td rowspan="3">Ada, C, C++, Fortran, Obj-C, Obj-C++ </td>
            <td rowspan="3">9 (gdb, libassuan, libgcrypt, libgpg-error, libksba, libnpth, nsis, win-iconv, zlib) </td>
        </tr>
        <tr>
            <td colspan="2">Debian 11 (Bullseye) </td>
            <td>10.2.1/8.0.0 </td>
        </tr>
        <tr>
            <td colspan="2">Debian 12 (Bookworm) </td>
            <td>12.0.0/10.0.0 </td>
        </tr>
        <tr>
            <td style="text-align:center;" rowspan="2">
                <strong><a href="https://www.mingw-w64.org/downloads/#fedora"><img src="https://www.mingw-w64.org/logos/fedora-logo.png" title="Fedora Linux logo" alt="Fedora Linux logo" width="32"></a><br><a href="https://www.mingw-w64.org/downloads/#fedora"> Fedora</a></strong>
            </td>
            <td colspan="2">Fedora 40 </td>
            <td>14.1.1/11.0.1 </td>
            <td rowspan="2">Ada, C, C++, Fortran, Obj-C, Obj-C++ </td>
            <td rowspan="2"><a href="https://packages.fedoraproject.org/search?query=mingw64"> many</a></td>
        </tr>
        <tr>
            <td colspan="2">Fedora 41 </td>
            <td>14.2.1/12.0.0 </td>
        </tr>
        <tr>
            <td style="text-align:center;">
                <strong><a href="https://www.mingw-w64.org/downloads/#llvm-mingw">LLVM-MinGW</a></strong>
            </td>
            <td>20240518</td>
            <td>Windows, Linux, macOS</td>
            <td>LLVM 18.1.6/trunk</td>
            <td>C, C++</td>
            <td>make, Python</td>
        </tr>
        <tr>
            <td style="text-align:center;">
                <strong><a href="https://www.mingw-w64.org/downloads/#macports"><img src="https://www.mingw-w64.org/logos/macports-logo.png" title="MacPorts logo" alt="MacPorts logo" width="32"></a><br><a href="https://www.mingw-w64.org/downloads/#macports">
                        MacPorts</a></strong>
            </td>
            <td>Rolling </td>
            <td>macOS</td>
            <td>
                <a href="https://github.com/macports/macports-ports/blob/master/cross/x86_64-w64-mingw32-gcc/Portfile" class="urlextern" title="https://github.com/macports/macports-ports/blob/master/cross/x86_64-w64-mingw32-gcc/Portfile" rel="nofollow">14.2.0</a>/<a href="https://github.com/macports/macports-ports/blob/master/cross/mingw-w64/Portfile" class="urlextern" title="https://github.com/macports/macports-ports/blob/master/cross/mingw-w64/Portfile" rel="nofollow">12.0.0</a>
            </td>
            <td>C, C++, Fortran, Obj-C, Obj-C++ </td>
            <td>1 (nsis)</td>
        </tr>
        <tr>
            <td style="text-align:center;">
                <strong><a href="https://www.mingw-w64.org/downloads/#mingw-w64-builds">MinGW-W64-builds</a></strong>
            </td>
            <td>Rolling </td>
            <td>Windows</td>
            <td>13.1.0/11.0.0 </td>
            <td>C, C++, Fortran </td>
            <td>4 (gdb, libiconf, python, zlib) </td>
        </tr>
        <tr>
            <td style="text-align:center;">
                <strong><a href="https://www.mingw-w64.org/downloads/#msys2" class="media" title="download:msys2"><img src="https://www.mingw-w64.org/logos/msys2-logo.png" title="MSYS2 logo" alt="MSYS2 logo" width="32"></a><br>
                            <a href="https://www.mingw-w64.org/downloads/#msys2">MSYS2</a></strong>
            </td>
            <td>Rolling </td>
            <td>Windows</td>
            <td>
                <a href="https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-gcc/PKGBUILD" class="urlextern" title="https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-gcc/PKGBUILD" rel="nofollow">14.2.0</a>/<a href="https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-crt-git/PKGBUILD" class="urlextern" title="https://github.com/msys2/MINGW-packages/blob/master/mingw-w64-crt-git/PKGBUILD" rel="nofollow">trunk</a>
            </td>
            <td>Ada, C, C++, Fortran, Obj-C, Obj-C++, OCaml </td>
            <td><a href="https://packages.msys2.org">many</a></td>
        </tr>
        <tr>
            <td style="text-align:center;" rowspan="4">
                <strong><a href="https://www.mingw-w64.org/downloads/#ubuntu"><img src="https://www.mingw-w64.org/logos/ubuntu-logo.png" title="Ubuntu logo" alt="Ubuntu logo" width="32"></a><br><a href="https://www.mingw-w64.org/downloads/#ubuntu"> Ubuntu</a></strong>
            </td>
            <td colspan="2"> 20.04 Focal Fossa </td>
            <td>9.3.0/7.0.0 </td>
            <td rowspan="4">Ada, C, C++, Fortran, Obj-C, Obj-C++ </td>
            <td rowspan="4">9 (gdb, libassuan, libgcrypt, libgpg-error, libksba, libnpth, nsis, win-iconv, zlib) </td>
        </tr>
        <tr>
            <td colspan="2"> 22.04 Jammy Jellyfish </td>
            <td>10.3.0/8.0.0 </td>
        </tr>
        <tr>
            <td colspan="2"> 24.04 Noble Numbat </td>
            <td>13.2.0/11.0.1 </td>
        </tr>
        <tr>
            <td colspan="2"> 24.10 Oracular Oriole </td>
            <td>14.1.0/12.0.0 </td>
        </tr>
        <tr>
            <td style="text-align:center;">
                <strong><a href="https://www.mingw-w64.org/downloads/#w64devkit">w64devkit</a></strong>
            </td>
            <td>2.0.0</td>
            <td>Windows</td>
            <td>14.2.0/12.0.0</td>
            <td>C, C++, Fortran</td>
            <td>
                8
                (busybox,
                cppcheck,
                ctags,
                gdb,
                make,
                nasm,
                pkg-config,
                vim)
            </td>
        </tr>
        <tr>
            <td style="text-align:center;">
                <strong><a href="https://www.mingw-w64.org/downloads/#winlibscom">WinLibs.com</a></strong>
            </td>
            <td>Rolling </td>
            <td>Windows</td>
            <td>
                <a href="https://winlibs.com/#download-release" class="urlextern" title="https://winlibs.com/" rel="nofollow">13.2.0</a>
            </td>
            <td>Ada, C, C++, Fortran, Obj-C, Obj-C++, Assembler</td>
            <td>Package manager: work in progress (will offer &gt; 2500 packages)</td>
        </tr>
    </tbody>
</table>

### 2.1. Windows 端开发的版本对比
由于嵌入式开发中主要在 Linux 或 Windows 系统进行开发，而 Linux 系统自带 GCC 可以直接编译工具链进行开发，这里仅对 MinGW-w64 提供的用于 Windows 系统开发，且编译器采用 GCC 的工具进行介绍：

1. 使用 [Cygwin](https://cygwin.com/install.html) 客户端进行安装;
    - 工具链包括大部分的软件包，可以通过可视化安装软件自由选择安装，在 Windows 端嵌入式开发常用；
2. 使用 [MinGW-W64-builds](https://github.com/niXman/mingw-builds-binaries/releases) 进行安装;
    - 该工具链仅包括 4 个 (gdb, libiconf, python, zlib) 软件包，无自带安装包管理软件；
3. 使用 [MSYS2](https://www.msys2.org/) 进行安装;
    - 该工具链包括很多软件包，可以通过 pacman 命令进行安装；
4. 使用 [w64devkit](https://github.com/skeeto/w64devkit) 进行安装;
    - 该工具链包括 8 （busybox, cppcheck, ctags, gdb, make, nasm, pkg-config, vim）个软件包，无自带安装包管理软件；
5. 使用 [WinLibs.com](https://winlibs.com/) 进行安装;
    - 该工具链包括 2500+ 个软件包，通过 pacman 命令进行安装；


| **维度**         | **Cygwin**                  | **MinGW-W64-builds**       | **MSYS2**                  | **w64devkit**             | **WinLibs**               |
|------------------|-----------------------------|---------------------------|----------------------------|---------------------------|---------------------------|
| **性能**         | 低（系统调用转换开销）      | 高（原生 Win32）          | 高（MinGW 模式）           | 高（纯 Win32）            | 高（原生 Win32）          |
| **POSIX 兼容性** | 高（模拟 Linux 层）         | 低（原生 Win32）          | 可选（MSYS2/POSIX 模式）   | 无                        | 低（原生 Win32）          |
| **工具链**       | GCC/Clang（需手动安装）     | 预编译 GCC/LLVM           | GCC/Clang/MSVC（pacman）   | 固定版本 GCC              | GCC + LLVM/Clang（可选）  |
| **调试支持**     | GDB（需配置符号路径）       | GDB（原生支持）           | GDB/LLDB（IDE 友好）       | 基础 GDB                 | GDB（完整符号）           |
| **跨平台编译**   | 不支持（依赖 `cygwin1.dll`）| 支持（Linux→Windows）     | 支持（需切换工具链）       | 不支持                   | 支持（需配置）           |
| **IDE 兼容性**   | 需特殊配置（如 Cygwin 模式）| 直接支持（VS Code/CLion） | 完美支持（VS Code 插件）   | 有限（手动配置路径）      | 直接支持（VS Code）       |
| **维护状态**     | 活跃（Red Hat 支持）        | 活跃（社区维护）          | 非常活跃（官方维护）       | 停滞（旧版工具链）        | 一般（社区驱动）          |
| **推荐场景**     | Linux 工具链移植            | 高性能原生 Windows 二进制 | 混合开发（C++/WinAPI）     | 快速验证代码              | 嵌入式交叉编译           |

### 2.2. 版本总结
如果只需要进行 8位/32位单片机（STM32、AVR等）芯片开发，仅使用 make 、 gcc 等工具，可以直接下载 `w64devkit` 工具套件，解压后可以直接使用，其中交叉编译器如 arm-none-eabi-gcc 需要自行下载，适用于临时快速验证。

而使用 `Winlibs` 进行自行组建时，可以直接支持 OpenOCD 调试工具和交叉编译工具 ARM-GCC 。

`MinGW-W64-builds` 更适用于 RISC-V/Linux 嵌入式的开发，原生Windows性能，无 POSIX 依赖，但是需要手动管理交叉编译工具链，且不包含调试工具链。

`Cygwin` 工具套件相比上述版本，是唯一支持完整 POSIX 的环境的版本。其使用更简单，支持且软件工具安装包更全，无需命令行安装。缺点是性能低（系统调用转换开销），不适合实时调试，使用依赖cygwin1.dll，系统兼容性差。

`MSYS2` 工具套件拥有最全工具链支持，完美兼容 Zephyr/RT-Thread 等 RTOS 开发环境其使用，软件包管理更新更快。缺点是需熟悉 pacman 命令，初始配置复杂（如镜像源、依赖冲突）。。
