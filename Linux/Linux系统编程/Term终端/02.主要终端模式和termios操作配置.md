# linux 终端模式和使用方法
在Unix和类Unix系统中，终端模式主要分为两种：**规范模式（Canonical Mode）** 和 **非规范模式（Non-Canonical Mode）**。每种模式都有其特定的用途和适用场景。

- **规范模式** 适用于需要行缓冲、回显和行编辑的交互式场景。
- **非规范模式** 适用于需要实时响应用户输入、不进行额外处理的场景。

## 1. 规范模式（Canonical Mode）

**规范模式** 是终端的默认模式。在这种模式下，输入是行缓冲的，即输入的数据在用户按下回车键之前不会被处理。此外，规范模式还提供了一些额外的处理功能，如回显、行编辑和信号字符处理。

### 1.1. 主要特征：
- **行缓冲**：输入数据在用户按下回车键之前不会被读取。
- **回显**：输入的字符会被显示在终端上。
- **行编辑**：用户可以使用退格键（Backspace）和删除键（Delete）来编辑输入的行。
- **信号字符**：某些特殊字符（如 Ctrl-C、Ctrl-D、Ctrl-\）会被解释为信号，用于中断程序、结束输入等。

### 1.2. 适用场景：
- **交互式命令行**：如 shell 命令行界面，用户可以输入命令并编辑输入。
- **文本编辑器**：如 `vi` 或 `nano`，用户可以编辑文本文件。
- **脚本输入**：用户需要输入多行脚本或命令。

### 1.3. 代码示例
```c
struct termios term;
tcgetattr(fd, &term);
term.c_lflag |= ICANON;  // 启用规范模式
tcsetattr(fd, TCSANOW, &term);
```

## 2. 非规范模式（Non-Canonical Mode）--Cbreak 模式
非规范模式分为两种： `Cbreak` 模式和 `Raw` 模式。

Cbreak 模式是一种半规范模式，它允许行编辑，但不进行行缓冲。
### 2.1. 主要特征：
- 逐字符读取，无需回车键。
- 保留部分处理（如信号和回显可选）

### 3.2. 适用场景：
需要简单实时输入但不需完全原始数据的场景（如菜单选择、游戏控制）。

### 3.3. 代码示例
```c
term.c_lflag &= ~ICANON;    // 关闭规范模式
term.c_lflag &= ~ECHO;      // 可选：关闭回显
term.c_cc[VMIN] = 1;        // 至少读取1个字符
term.c_cc[VTIME] = 0;       // 无超时
```

## 3. 非规范模式（Non-Canonical Mode）--原始模式（Raw Mode）
非规范模式分为两种： `Cbreak` 模式和 `Raw` 模式。

**原始模式（Raw Mode）**是一种完全的非规范模式，它不进行行缓冲、回显、行编辑和信号字符处理。

### 3.1. 主要特征：
- 完全禁用所有字符处理（无信号、无回显、无转换）。
- 直接传输原始字节流

### 3.2. 适用场景：
- **实时数据输入**：如游戏、实时控制程序，需要立即响应用户输入。
- **密码输入**：用户输入密码时，不希望密码被显示在终端上。
- **串口通信**：需要直接读取和处理串口数据，不进行额外的处理。
- **传感器数据读取**：需要实时读取传感器数据，不进行行缓冲。

### 3.3. 代码示例
```c
term.c_lflag &= ~(ICANON | ECHO | ISIG | IEXTEN);  // 禁用规范模式及扩展功能
term.c_iflag &= ~(BRKINT | ICRNL | INPCK | ISTRIP | IXON); // 禁用输入转换
term.c_oflag &= ~OPOST;      // 禁用输出处理
term.c_cc[VMIN] = 1;         // 至少读取1个字符
term.c_cc[VTIME] = 0;        // 无超时
```


## **4. 其他模式**
### **(a) 伪终端（Pseudo-Terminal, pty）**
- **行为特点**：
  - 通过软件模拟的终端（如SSH连接、图形界面下的终端窗口）。
  - 设备文件为`/dev/pts/*`，支持多会话。
- **配置代码**：无需手动配置，由终端仿真器（如GNOME Terminal）自动管理。

### **(b) 虚拟终端（Virtual Terminal, tty）**
- **行为特点**：
  - 物理终端通过快捷键（`Ctrl+Alt+F1~F6`）切换的文本界面。
  - 设备文件为`/dev/tty1~tty6`。
- **配置代码**：系统默认配置，用户无需修改。


## 4. **对比总结**
| **模式**       | **配置标志位**                          | **输入行为**       | **典型场景**               | **引用来源**      |
|-----------------|----------------------------------------|--------------------|---------------------------|-------------------|
| 规范模式        | `ICANON`启用                           | 行缓冲输入         | 命令行交互、表单输入       |          |
| 非规范-Cbreak   | `ICANON`禁用，可选`ECHO`和`ISIG`       | 逐字符输入         | 实时菜单、简单游戏         |          |
| 非规范-原始模式 | 禁用`ICANON`, `ECHO`, `ISIG`, `IEXTEN` | 原始字节流         | 串口通信、嵌入式设备       |          |
| 伪终端          | 自动管理                               | 模拟终端会话       | SSH远程连接、图形终端窗口  |          |
| 虚拟终端        | 系统默认                               | 物理终端切换       | 多用户文本界面登录         |          |




