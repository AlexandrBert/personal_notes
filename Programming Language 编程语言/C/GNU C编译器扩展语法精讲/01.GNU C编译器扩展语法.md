# GNU C编译器扩展语法

## 1. C语言标准和编译器
在C语言早期，各大编译器厂商在开发自己的编译器时，各自开发，各自维护，时间久了，就变得比较混乱，造成这样一种局面：程序员写的程序，在一个编译器上编译可以通过，在另一个编译器上编译可能就通不过。大家按照各自的习惯来，谁也不服谁，就像春秋战国时期，不同的货币、不同的度量衡、不同的文字，都是中国人，因为标准不统一，所以交流起来很麻烦，这样下去也不是办法。

后来美国国家标准协会（American National Stardards Institude，ANSI）联合国际化标准组织（International Organization for Standardization，ISO）召集各个编译器厂商和各种技术团体一起开会，开始启动C语言的标准化工作。期间各种大佬之间也是矛盾重重，充满各种争议，但功夫不负有心人，经过艰难的磋商，终于在1989年达成一致，发布了第一版C语言标准，并在第二年做了一些改进。于是，就像秦始皇统一六国，统一文字和度量衡一样，C语言标准终于问世了。C语言标准因为是在1989年发布的，所以人们一般称其为C89或C90标准，或者叫作ANSI C标准。

### 1.1. C语言标准的内容
C语言标准主要讲了什么内容？

打开C语言标准文档，洋洋洒洒几百页，讲了很多东西，但总体归纳起来，主要就是C语言编程的一些语法惯例、约定规则，如在C语言标准里：
- 定义各种关键字、数据类型。
- 定义各种运算规则、各种运算符的优先级和结合性。
- 数据类型转换。
- 变量的作用域。
- 函数原型、函数嵌套层数、函数参数个数限制。
- 标准库函数接口。

C语言标准发布后，大家都遵守这个标准开展工作：程序员开发程序时，按照这种标准规定的语法规则编写程序；编译器厂商开发编译器工具时，也按照这种标准去解析、翻译程序。不同的编译器厂商支持统一的C语言标准，我们编写的同一个程序使用不同的编译器都可以正常编译和运行。

### 1.2. C语言标准的发展过程
C语言标准并不是永远不变的，就和无限通信标准一样，也是从2G、3G、4G到5G不断发展变化的。C语言标准也经历了下面4个阶段。
- K&R C.
    - K&R C一般也称为传统C。在C语言标准没有统一之前，C语言的作者Dennis M.Ritchie和Brian W.Kernighan合作写了一本书《C程序设计语言》。早期程序员编程，这本书可以说是绝对权威的。这本书很薄，内容精炼，主要介绍了C语言的基本编程语法。后来《C程序设计语言》第二版问世，做了一些修改，如新增unsigned int、long int、struct等数据类型；把运算符=+/=-修改为+=/-=，避免运算符带来的一些歧义和bug。第二版可以看作ANSI标准的雏形，但早期的C语言还是很简单的，如还没有定义标准库函数、没有预处理命令等。
- ANSI C.
    - ANSI C是ANSI在K&R C的基础上，统一了各大编译器厂商的不同标准，并对C语言的语法和特性做了一些扩展，在1989年发布的一个标准。这个标准一般也叫作C89/C90标准，也是目前各种编译器默认支持的C语言标准。ANSI C标准主要新增了以下特性。
        - 增加了signed、volatile、const关键字。
        - 增加了void*数据类型。
        - 增加了预处理器命令。
        - 增加了宽字符、宽字符串。
        - 定义了C标准库。
        - ……
- C99.
    - C99标准是ANSI在1999年基于C89标准发布的一个新标准。该标准对ANSI C标准做了一些扩充，如新增了一些关键字，支持新的数据类型。
        - 布尔型：_Bool。
        - 复数：_Complex。
        - 虚数：_Imaginary。
        - 内联：inline。
        - 指针修饰符：restrict。
        - 支持long long、long double数据类型。
        - 支持变长数组。
        - 允许对结构体特定成员赋值。
        - 支持十六进制浮点数、float_Complex等数据类型。
        - ……
    - C99标准也会借鉴其他编程语言的一些优点，对自身的语法和标准做一系列改进，例如：
        - 变量声明可以放在代码块的任何地方。ANSI C标准规定变量的声明要全部写在函数语句的最前面，否则就会报编译错误。现在不需要这样写了，哪里需要使用变量，直接在哪里声明即可。
        - 源程序每行最大支持4095字节。这个貌似足够用了，没有什么程序能复杂到一行程序有4000多个字符。
        - 支持//单行注释。早期的ANSI C标准使用/**/注释，不如C++的//注释方便，所以C99标准就把这种注释吸收过来了，从C99标准开始也支持这种注释方式。
        - 标准库新增了一些头文件，如stdbool.h、complex.h、stdarg.h、fenv.h等。大家在C语言中经常返回的true、false，其实这是C++里面的定义的bool类型，早期的C语言是没有bool类型的。那为什么我们经常这样写，而编译器编译程序时没有报错呢？这是因为早期大家编程使用的都是VC++6.0系列，使用的是C++编译器，C++编译器是兼容ANSI C标准的。当然还有一种可能就是有些IDE对这种数据类型做了封装。
- C11.
    - C11标准是ANSI在2011年发布的最新C语言标准，C11标准修改了C语言标准的一些bug，增加了一些新特性。
        - 增加_Noreturn，声明函数无返回值。
        - 增加_Generic，支持泛型编程。
        - 修改了标准库函数的一些bug，如gets()函数被gets_s()函数代替。
        - 新增文件锁功能。
        - 支持多线程。
        - ……

从C11标准的新增内容，我们可以观察到C语言未来的发展趋势。C语言现在也在借鉴现代编程语言的优点，不断添加到自己的标准里。如现代编程语言的多线程、字符串、泛型编程等，C语言最新的标准都支持。但是这样下去，C语言会不会变得越来越臃肿？是不是还能保持它“简单就是美”的初心呢？这一切只能交给时间了，至少目前我们不用担心这些，因为新发布的C11标准，目前绝大多数编译器还不支持，我们暂时还用不到。

### 1.2. 编译器对C语言标准的扩展
不同编译器，出于开发环境、硬件平台、性能优化的需要，除了支持C语言标准，还会自己做一些扩展。

在51单片机上用C语言开发程序，我们经常使用Keil for C51集成开发环境。你会发现Keil for C51或者其他IDE里的C编译器会对C语言做很多扩展，如增加了各种关键字。
- data：RAM的低128B空间，单周期直接寻址。
- code：表示程序存储区。
- bit：位变量，常用来定义51单片机的P0～P3管脚。
- sbit：特殊功能位变量。
- sfr：特殊功能寄存器。
- reentrant：重入函数声明。

如果你在程序中使用以上这些关键字，那么你的程序只能使用51编译器来编译运行；如果你使用其他编译器，如VC++6.0，则编译是通不过的。

同样的道理，GCC编译器也对C语言标准做了很多扩展。
- 零长度数组。
- 语句表达式。
- 内建函数。
- __attribute__特殊属性声明。
- 标号元素。
- case范围。
- ……

如支持零长度数组，这些新增的特性，C语言标准目前是不支持的，其他编译器也不支持。如果你在程序中定义一个零长度数组，则只能使用GCC编译器才能正确编译，使用VC++6.0编译器编译可能就通不过，因为Microsoft的C++编译器不支持这个特性。


